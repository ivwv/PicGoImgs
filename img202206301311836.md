DropzoneJs中文

# **介绍**

JavaScript 库 Dropzone 的文档。

Dropzone 是一个简单的 JavaScript 库，可帮助您将文件拖放功能添加到 Web 表单。它是网络上最受欢迎的拖放库之一，被数百万人使用。

有*许多*配置选项，因此 Dropzone 可以在各种情况下使用。

Dropzone 的一些亮点包括：

- 默认漂亮。
- 图像缩略图预览。只需注册回调`thumbnail(file, data)`并在任何你喜欢的地方显示图像
- 进度条
- 启用视网膜
- 多个文件和同步上传
- 支持大文件
- 分块上传（单个文件可以在多个 HTTP 请求中作为块上传）
- 完成主题化。Dropzone 的外观和感觉只是默认主题。你可以通过覆盖默认事件侦听器自己定义所有内容。
- 浏览器图像大小调整（在将图像上传到您的服务器）
- 测试良好

## **安装**

有两种方法可以将 Dropzone 添加到您的项目中。如果您使用的是包管理器，请参阅[npm 或纱线](https://docs.dropzone.dev/getting-started/installation/npm-or-yarn)部分。如果您只是想在没有任何捆绑程序或包管理器的情况下使用 Dropzone，请参阅[独立文件]()部分。

## **npm or yarn**

这就是我自己使用图书馆的方式

与大多数可视化 JavaScript 库一样，故事有两个方面：在项目中获取 JavaScript 代码，以及获取 CSS 代码。让我们从 JS 开始。

将 dropzone 作为依赖项添加到您的项目中：

```js
npm install --save dropzone
```

在您的 html 中，确保您有一个将充当 dropzone 的元素：

```html
<!-- Example of a form  -->
<form action="/target" class="dropzone"></form>
```

### JavaScript

无需过多详细介绍，从历史上看，有很多方法可以在 JavaScript 中导入库。幸运的是，不久前引入了一个标准，该标准也在浏览器中实现。该标准称为[ECMAScript 模块](https://nodejs.org/api/esm.html)，通常也称为[JavaScript 模块](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules)。这导致 JavaScript 模块成为事实上的标准，这就是我推荐使用这种方法的原因。

在 JavaScript 模块之前，还有很多其他标准。Dropzone 现在支持的唯一其他模块标准是[CommonJS 格式](https://en.wikipedia.org/wiki/CommonJS)，这也是 node 使用的格式（注意[node 现在也支持 JavaScript 模块](https://nodejs.medium.com/announcing-core-node-js-support-for-ecmascript-modules-c5d6dc29b663)）。

我们还提供了一个独立文件，您可以简单地将其包含在您的浏览器中。请参阅相应的部分：[独立文件]().

```js
// 如果你正在使用 JavaScript/ECMAScript 模块:
import Dropzone from "dropzone";

// 如果您正在使用CommonJS模块:
const { Dropzone } = require("dropzone");

//如果使用的是比 Dropzone 6.0更老的版本，
//然后您需要在这里禁用autoDiscover行为:
Dropzone.autoDiscover = false;

let myDropzone = new Dropzone("#my-form");
myDropzone.on("addedfile", file => {
  console.log(`File added: ${file.name}`);
});

```

**!注意：为了让 Dropzone 找到`#my-form` 元素必须已经存在`<script>` 在 HTML 文件的末尾导入，或者使用某种`window.onload` 逻辑**

# CSS

Dropzone 提供两个文件: a`basic.css` 还有`dropzone.css` 。的`dropzone.css` 包含您可以在示例中看到的所有样式，是一个现成的解决方案。如果希望完全控制样式，可以使用`basic.css` 作为基础，并在此基础上构建，或者根本不使用任何提供的 CSS 文件

导入这个 CSS 文件在很大程度上取决于您正在使用的捆绑包或框架，因此我在这里不会详细介绍

您也可以简单地在 html 中包含 CSS 文件[ 独立文件]() 这部分

## **Composer**

依赖管理器

Dropzone 发布到[ 包装商](https://packagist.org/packages/enyo/dropzone) 并与作曲家兼容。使用它作为你会任何其他软件包

## **Stand-alone file 独立文件**

只需下载文件

我不推荐这个选项，因为它很难维护，但有时您只是有一个小项目，您不想花费任何不必要的时间，并使用独立的`.js` files is fine for you. 文件对你来说没问题

您可以直接链接到 unpkg 主机，而不必自己下载文件，如下所示:

```js
<script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" type="text/css" />
```

Dropzone 现在是活跃的，可以作为`window.Dropzone`.

**! 注意，导入的 css 文件是可选的**

#### Dropzone v6

在版本6中放弃了对 Internet Explorer 的支持，目前仍处于 beta 测试阶段。如果你已经想要使用一个更轻量级的脚本(46kB vs 115kB) ，并且不关心 Internet Explorer 支持，你可以像下面这样选择:

```js
<script src="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone-min.js"></script>
<link href="https://unpkg.com/dropzone@6.0.0-beta.1/dist/dropzone.css" rel="stylesheet" type="text/css" />
```

如果需要，请务必检查[ 彻底改变](https://github.com/dropzone/dropzone/blob/main/CHANGELOG.md) 确保突破性的改变不会影响到你

## **Setup**

如何在网站上设置 Dropzone

等你[ 安装了 Dropzone](https://docs.dropzone.dev/getting-started/installation) 设置 Dropzone 有两种方法。最简单的方法是让 Dropzone 自动发现您的表单，并自动附加拖放事件。为此，您只需要为窗体提供一个类。这个叫做 **陈述性的** 设计

[Declarative 陈述性的](https://docs.dropzone.dev/getting-started/setup/declarative)

如果您有一个更复杂的用例，或者您想要控制 *什么时候* 在创建 Dropzone 对象并监听事件时，您可以自己实例化 Dropzone **势在必行** 设计

[Imperative 当务之急](https://docs.dropzone.dev/getting-started/setup/imperative)

Which approach is better?

没有一种方法比另一种更好。我想说的是，如果您使用包管理器，那么您可能更喜欢 **势在必行** 接近，但是 **陈述性的** 方法一般比较简单

选择 **陈述性的** 接近..

## **Declarative** 陈述性的

如何使用 HTML 属性创建 Dropzone 上传

使用 dropzone 最简单的方法是使用类创建一个 form 元素`dropzone`:

```html
<form action="/file-upload"
      class="dropzone"
      id="my-awesome-dropzone"></form>
```

就是这样。Dropzone 将找到所有带有类 Dropzone 的表单元素，自动将自己附加到该元素上，并将放入该元素的文件上传到指定的`action` 上传的文件可以像下面这样处理 html 输入:

```html
<input type="file" name="file" />
```

**!注意** 如果你想要别的名字`file` 你可以的[ 配置 Dropzone]() 还有选择权`paramName`.

#### Configuration 配置

当像这样声明一个 Dropzone 时，你可能想知道如何配置它，幸运的是这很容易:

- 给出要配置 html 的元素`id`
- 将配置设置为`Dropzone.options`

##### Example:

```js
<script>
  // 注意：名称 "myDropzone" is the 关键词
  // id of the form.
  Dropzone.options.myDropzone = {
    // 配置选项放在这里
  };
</script>
<form action="/target" class="dropzone" id="my-dropzone"></form>
```

您可以根据需要在 Dropzone.options 上创建尽可能多的选项ーー对于您创建的每个 HTML 元素，只需添加配置即可

有关可用配置选项的信息，请参见[ 配置部分]().

#### The "auto discover" feature “自动发现”功能

**!注意** 自动发现功能已经在 Dropzone 版本6.0.0中删除！如果您依赖于此，您可以简单地将此代码添加到您的文档末尾:

```js
<script>
  Dropzone.discover();
</script>
```

这种工作方式被称为“自动发现”。Dropzone 检查 DOM 内容何时完成加载，然后解析所有 HTML 元素，并在类中查找一个元素`dropzone` 。如果它找到一个元素，它检查该元素是否有`id` 如果是，则将 id 名称转换为驼峰大小写(`my-dropzone` -> `myDropzone` ) ，并检查是否有一个条目`Dropzone.options` 如果有，那么它使用该配置对象来实例化该对象的 Dropzone

可以通过两种方式禁止这种行为:

- 都可以`Dropzone.autoDiscover = false;` 只要确保在分派 DOM 就绪事件之前调用了它
- 预备`Dropzone.options.myDropzone = false;` 这允许你使用自动发现功能，并且只对特定的元素禁用它
- **!注意 ** Dropzone 在文档加载完成后解析文档，查找具有`dropzone` 类中是否有配置`Dropzone.options` 然后为该元素创建一个 Dropzone 实例。如果所有这些都发生在您定义配置之前，那么 **Dropzone 会错过配置** 。所以确保，你的 **配置** 代码是 **之前达到的** 空降区 **自动发现** 这些元素

如果你不太喜欢这种方法，不要担心。转到下一节，看看如何命令式地创建它们

## **Imperative** 当务之急

如何使用 JavaScript 创建 Dropzone 上传

作为声明式方法的替代方法，您可以强制创建 Dropzone (甚至在 non`<form>` 元素) ，方法是实例化`Dropzone` 类:

```js
//  The constructor of
//
// //1．要添加的HTML元素的选择器
//Dropzone到，第二个
//2．带有配置的(可选)对象
let myDropzone = new Dropzone("div#myId", { url: "/file/post"});
```

**!注意 ** 不要忘记指定一个`url` 如果不使用`<form>` 元素，因为 Dropzone 不知道在没有 action 属性的情况下发布到哪里`action` 属性

有关所有配置选项的列表，请参见[ 配置部分]().

## **服务器端实现**

如何处理服务器上上传的文件

空降地带有 **没有** 提供处理文件的服务器端实现

**!注意**  如果您不能或不想实现自己的服务器，那么可以考虑使用[**空降区加号**](https://www.dropzone.dev/plus) ！它是一种接受表单数据(包括文件)并为您存储它们的服务。您可以使用提交的数据方便地更新电子邮件，还可以使用仪表板查看和导出收到的数据

上传文件的方式与使用标准 HTML 表单的标准文件上传相同，如下所示:

```html
<form action="" method="post" enctype="multipart/form-data">
  <input type="file" name="file" />
</form>
```

因此，如果您的服务器接受文件，像这样上传，它将接受文件上传与 Dropzone

因此，请查看您正在使用的服务器实现的相应文档。这里有一些文件，如果你认为我应该添加一些，请与我联系

- [Spring 春天](https://spring.io/guides/gs/uploading-files/)
- [NodeJS with express 使用 Express 的 NodeJS](http://howtonode.org/really-simple-file-uploads)
- [Ruby on rails 红宝石在轨道上](http://guides.rubyonrails.org/form_helpers.html#uploading-files)
- [Complete PHP tutorial 完成 PHP 教程](http://www.startutorial.com/articles/view/how-to-build-a-file-upload-form-using-dropzonejs-and-php) by startutorial.com
- [Basic PHP file upload 基本 PHP 文件上传](http://www.php.net/manual/en/features.file-upload.post-method.php#example-354)
- [Tutorial for Dropzone and Lavarel (PHP) Dropzone 和 Lavarel 教程(PHP)](http://maxoffsky.com/code-blog/howto-ajax-multiple-file-upload-in-laravel/) written by Maksim Surguy 作者: Maksim Surguy
- [Symfony2 and Amazon S3 Symfony2和 Amazon S3](http://www.jesuisundev.fr/upload-drag-drop-via-dropzonejs-symfony2-on-cloud-amazon-s3/)
- [File upload in ASP.NET MVC using Dropzone JS and HTML5](http://venkatbaggu.com/file-upload-in-asp-net-mvc-using-dropzone-js-and-html5/)
- [Servicestack and Dropzone Servicestack 和 Dropzone](http://www.buildclassifieds.com/2016/01/08/uploading-images-servicestack-and-dropzone/)
- [How to build a file upload form using DropzoneJS and Go 如何使用 DropzoneJS 和 Go 构建文件上传表单](https://hackernoon.com/how-to-build-a-file-upload-form-using-dropzonejs-and-go-8fb9f258a991)
- [How to display existing files on server using DropzoneJS and Go 如何使用 DropzoneJS 和 Go 显示服务器上的现有文件](https://hackernoon.com/how-to-display-existing-files-on-server-using-dropzonejs-and-go-53e24b57ba19)

付费文件:

- [ 基于 PHP 的 Dropzone 电子书](http://www.startutorial.com/homes/dropzonejs_php_the_complete_guide?utm_source=dzj&utm_medium=banner&utm_campaign=dropzonejs) by startutorial.com.

请看[ 空投区常见问题](https://gitlab.com/meno/dropzone/-/wikis/FAQ) 如果你需要更多信息

## **Fallback for no JavaScript** 没有 JavaScript 的后备

以防您想处理没有启用 JavaScript 的浏览器

有时你需要建立网站，应该工作，即使用户没有启用 JavaScript 或浏览器不支持。当然，拖放 JavaScript 库在这些情况下不会起作用，但 Dropzone 提供了一种定义备用的方法，从而为您解决了这个问题

在您的下拉区 HTML 元素(in most cases that's a  <form>` element) ，可以使用类定义一个附加元素`fallback` 。当(or in this case: "if") Dropzone 初始化，它将简单地删除这个元素

下面是一个例子:

```HTML
<form action="/file-upload" class="dropzone">
  <div class="fallback">
    <input name="file" type="file" multiple />
  </div>
</form>
```

因此，如果浏览器不支持 JavaScript，用户只需查看`fallback` Div，所有东西都可以正常工作，但是不支持拖放

*如果* 但是，如果支持浏览器，这个元素将被删除，Dropzone 将添加一个通知，说明它接受删除的文件并处理它们

## **基本知识**

在本节中，我们将讨论配置 Dropzone 的基础**知识**

**!注意** 中将配置对象传递到 Dropzone 的方法，您应该已经非常熟悉了[ 陈述性的]() 还有[ 势在必行]() 如没有，请浏览有关部分

下面是 Dropzone 的典型配置:

```html
Declarative

<form action="/target" class="dropzone" id="my-great-dropzone"></form>

<script>
  Dropzone.options.myGreatDropzone = { // camelized version of the `id`
    paramName: "file", // The name that will be used to transfer the file
    maxFilesize: 2, // MB
    accept: function(file, done) {
      if (file.name == "justinbieber.jpg") {
        done("Naha, you don't.");
      }
      else { done(); }
    }
  };
</script>
```

```vue
Imperative
import Dropzone from "dropzone";

let myDropzone = Dropzone({
  paramName: "file", // The name that will be used to transfer the file
  maxFilesize: 2, // MB
  accept: function(file, done) {
    if (file.name == "justinbieber.jpg") {
      done("Naha, you don't.");
    }
    else { done(); }
  }
});
```

**! 注意**有关所有可能选项的列表，请参阅[`src/options.js`](https://github.com/dropzone/dropzone/blob/main/src/options.js) 文件

#### Event 事件

如果您希望对正在发生的事件(文件已经添加或删除，上传已经启动，进度已经更改，等等)作出反应..。.)你想要听到事件。有关事件的更多信息，请查看事件部分

#### Overriding default event handlers 重写默认事件处理程序

！**注意** In general  一般来说**you should never have to do this 你不该这么做的**, and you should be familiar with the code if you decide to do it. ，并且如果您决定这样做，您应该熟悉代码

还可以重写默认事件处理程序。应该绝对谨慎地处理这个问题，因为如果您升级了库，它可能会中断，并且还可能删除您可能不希望丢失的默认功能:

```js
let myDropzone = Dropzone("#my-element", {
  addedfile: file => {
    // ONLY DO THIS IF YOU KNOW WHAT YOU'RE DOING!
  }
});
```

这里的不同之处在于，默认的事件处理程序`addedfile` 已更改，而不是添加新的事件处理程序`myDropzone.on("addedfile", () => {})`

## **Configuration Options** 配置选项


| Name                  | Default   | Description                                                                                                                                                                                                                                                                                                            |
| ----------------------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| url                   | url       | 必须在窗体以外的元素上指定(或者当窗体没有`action` 还可以提供一个函数，该函数将用`files` 并且必须返回 url (因为`v3.12.0`)                                                                                                                                                                                               |
| method                | "post"    | 可以改为`"put"` 如果需要，还可以提供一个函数`files` 并且必须返回该方法(因为`v3.12.0`).                                                                                                                                                                                                                                 |
| withCredentials       | false     | 将在 XHRequest 上设置                                                                                                                                                                                                                                                                                                  |
| timeout               | null      | XHR 请求的超时时间(以毫秒为单位)(自`v4.4.0` )。如果设置为 null 或0，则不设置超时                                                                                                                                                                                                                                       |
| parallelUploads       | 2         | 需要并行处理多少个文件上传(更多信息请参阅加入队列文件上传文档部分)                                                                                                                                                                                                                                                     |
| uploadMultiple        | false     | 是否在一个请求中发送多个文件。如果此值设置为 true，则回退文件输入元素将具有`multiple` 此选项还将触发其他事件(如`processingmultiple` )。有关更多信息，请参见事件文档部分                                                                                                                                                |
| chunking              | false     | 是否要将文件以块的形式上传到服务器。这不能与`uploadMultiple` . 请参见[ chunksUpload ](# config-chunksUpload)获取回调以完成上传                                                                                                                                                                                         |
| forceChunking         | false     | 如果`chunking` 即使文件大小低于 chunkSize，也将定义是否应该对 * * every * * 文件进行分块。这意味着，将提交额外的块表单数据，并且`chunksUploaded` 将调用回调函数                                                                                                                                                        |
| chunkSize             | 2000000   | 如果`chunking` 是`true` ，则这将以字节为单位定义块大小                                                                                                                                                                                                                                                                 |
| parallelChunkUploads  | false     | 如果`true` ，文件的各个块被同时上传                                                                                                                                                                                                                                                                                    |
| retryChunks           | false     | 如果块失败，是否应该重试该块                                                                                                                                                                                                                                                                                           |
| retryChunksLimit      | 3         | 如果`retryChunks` 是正确的，应该重试多少次                                                                                                                                                                                                                                                                             |
| maxFilesize           | 256       | 允许上载的最大文件大小(以字节为单位)                                                                                                                                                                                                                                                                                   |
| paramName             | "file"    | 要传输的文件参数的名称。 * * 注意 * * : 如果有选项`uploadMultiple` 准备好了`true` ，然后 Dropzone 将附加`[]` 名字                                                                                                                                                                                                      |
| createImageThumbnails | true      | 是否应生成图像的缩略图                                                                                                                                                                                                                                                                                                 |
| maxThumbnailFilesize  | 10        | 当文件名超过此限制时，将不会生成缩略图                                                                                                                                                                                                                                                                                 |
| thumbnailWidth        | 120       | 如果`null` ，图像的比率将被用来计算它                                                                                                                                                                                                                                                                                  |
| thumbnailHeight       | 120       | 和`thumbnailWidth` 。如果两者都为空，则图像不会调整大小                                                                                                                                                                                                                                                                |
| thumbnailMethod       | "crop"    | 如何缩小图像尺寸，以防两者同时,`thumbnailWidth` 还有`thumbnailHeight` 提供。可以是`contain` 或者`crop`.                                                                                                                                                                                                                |
| resizeWidth           | null      | 如果设置，图像将被调整到这些尺寸之前被 * * 上传 * * 。如果只有一个,`resizeWidth` 或者说`resizeHeight` 则文件的原始长宽比将被保留`options.transformFile` 函数使用这些选项，因此如果`transformFile` 函数被重写，则这些选项不执行任何操作                                                                                 |
| resizeHeight          | null      | 你看`resizeWidth`.                                                                                                                                                                                                                                                                                                     |
| resizeMimeType        | null      | 调整大小的图像的 mime 类型(在上传到服务器之前)`null` 将使用原始的 mime 类型`image/jpeg` 。看到`resizeWidth` 了解更多信息                                                                                                                                                                                               |
| resizeQuality         | 0.8       | 调整大小的图像的质量。请参见`resizeWidth`.                                                                                                                                                                                                                                                                             |
| resizeMethod          | "contain" | 如何缩小图像尺寸，以防两者同时,`resizeWidth` 还有`resizeHeight` 提供。可以是`contain` 或者`crop`.                                                                                                                                                                                                                      |
| filesizeBase          | 1000      | 用于计算 * * 显示的 * * 文件大小的基。如果希望显示 kibibyte、 mebibytes 等，可以将其更改为1024。.1024在技术上是不正确的，因为`1024 bytes` 是`1 kibibyte` 没有`1 kilobyte` 。你可以改变这个`1024` 如果你不在乎有效性                                                                                                    |
| maxFiles              | null      | 如果不是`null` 定义此 Dropzone 处理的文件数。如果超过此数，则事件`maxfilesexceeded` 将被调用。 drop zone 元素获取类`dz-max-files-reached` 因此，你可以提供视觉反馈                                                                                                                                                     |
| headers               | null      | 向服务器发送附加头的可选对象。例如:`{ "My-Awesome-Header": "header value" }`                                                                                                                                                                                                                                           |
| clickable             | true      | 如果`true` ，下拉区元素本身将是可点击的，如果`false` 没有任何东西是可以点击的。您还可以传递一个 HTML 元素、一个 CSS 选择器(用于多个元素)或这些元素的数组。在这种情况下，所有这些元素都会在单击时触发上传                                                                                                               |
| ignoreHiddenFiles     | true      | 是否应忽略目录中的隐藏文件                                                                                                                                                                                                                                                                                             |
| acceptedFiles         | null      | 的默认实现`accept` 根据此列表检查文件的 mime 类型或扩展名。这是一个逗号分隔的 mime 类型或文件扩展名列表。例子:`image/*,application/pdf,.psd` 如果空降区是的话`clickable` 此选项也将用作[`accept`](https://developer.mozilla.org/en-US/docs/HTML/Element/input#attr-accept) parameter on the hidden file input as well. |
| acceptedMimeTypes     | null      | **弃用! ** 使用接受的文件代替                                                                                                                                                                                                                                                                                          |
| autoProcessQueue      | true      | 如果为 false，文件将添加到队列中，但不会自动处理队列。如果在发送文件之前需要一些额外的用户输入(或者希望一次发送所有文件) ，那么这将非常有用。如果您准备发送文件，只需调用`myDropzone.processQueue()` 有关更多信息，请参见[排队文件上传](# 排队-文件上传)文档部分                                                       |
| autoQueue             | true      | 如果为 false，添加到下拉区域的文件将不会默认排队`enqueueFile(file)` 手动操作                                                                                                                                                                                                                                           |
| addRemoveLinks        | false     | 如果`true` ，这将添加一个链接到每个文件预览删除或取消(如果已经上传)的文件`dictCancelUpload`, `dictCancelUploadConfirmation` 还有`dictRemoveFile` 选项用于措辞                                                                                                                                                          |
| previewsContainer     | null      | 定义显示文件预览的位置-如果`null` 使用 Dropzone 元素本身。可以是普通的`HTMLElement` 或 CSS 选择器。元素应该具有`dropzone-previews` 类，以便正确显示预览                                                                                                                                                                |
| disablePreviews       | false     | 设置成`true` 如果你不想看预告片的话                                                                                                                                                                                                                                                                                    |
| hiddenInputContainer  | "body"    | 这是将附加到隐藏输入字段(单击下拉区域以触发文件选择时使用)的元素。这对于使用框架切换页面内容的情况可能很重要。可以是选择器字符串，也可以直接是元素                                                                                                                                                                     |
| capture               | null      | 如果为空，则不指定捕获类型如果为摄像机，移动设备将跳过文件选择并选择摄像机如果为麦克风，移动设备将跳过文件选择并选择麦克风如果为摄像机，移动设备将跳过文件选择并选择摄像机在视频模式下在苹果设备上多个必须设置为 false。AcceptedFiles 可能需要设置为适当的 mime 类型(例如“ image/*”、“ Audio/*”或“ video/*”)     |
| renameFilename        | null      | 废弃物，使用`renameFile` 取而代之                                                                                                                                                                                                                                                                                      |
| renameFile            | null      | 在文件上载到服务器并重命名文件之前调用的函数。此函数获取`File` 作为参数，并且可以使用`file.name` 。在上传期间使用的文件的实际名称可以通过`file.upload.filename`.                                                                                                                                                       |
| forceFallback         | false     | 如果`true` 撤退将被迫进行。这对于首先测试您的服务器实现非常有用，并确保在遇到问题时一切都按照预期运行，不会出现 dropzone，还可以测试您的备份看起来如何                                                                                                                                                                 |

## **Layout** 布局

通过 drop zone 为每个文件生成的 HTML 使用该选项定义`previewTemplate` which defaults to this: 默认为:

```html
<div class="dz-preview dz-file-preview">
  <div class="dz-details">
    <div class="dz-filename"><span data-dz-name></span></div>
    <div class="dz-size" data-dz-size></div>
    <img data-dz-thumbnail />
  </div>
  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>
  <div class="dz-success-mark"><span>✔</span></div>
  <div class="dz-error-mark"><span>✘</span></div>
  <div class="dz-error-message"><span data-dz-errormessage></span></div>
</div>
```

容器(`dz-preview` )`dz-processing` 当文件被处理时,`dz-success` 文件上传后`dz-error` 以防文件无法上传。在后一种情况下,`data-dz-errormessage` 将包含服务器返回的文本

若要覆盖默认模板，请使用`previewTemplate` 配置

您可以在任何事件中访问文件预览的 HTML`file.previewElement`.

如果您决定重写`previewTemplate` 从头开始，您应该将元素与`data-dz-*` 内部属性:

- `data-dz-name`
- `data-dz-size`
- `data-dz-thumbnail` (这必须是一个`<img />` 元素和`alt` 还有`src` 属性将被 Dropzone 更改)
- `data-dz-uploadprogress` (Dropzone 将改变`style.width` 财产`0%` 到`100%` 无论何时`uploadprogress` 事件)
- `data-dz-errormessage`

Dropzone 的默认选项将查找这些元素并更新其内容

如果您想要某个特定的链接来删除一个文件(而不是内置的`addRemoveLinks` 配置) ，您可以简单地在模板中插入元素，并使用`data-dz-remove` 例子:

```js
<img src="removebutton.png" alt="Click me to remove the file." data-dz-remove />
```

但是您不必使用这些约定。如果覆盖所有默认事件侦听器，则可以从头开始完全重新构建布局

如果您希望您的 Dropzone 看起来像示例 Dropzone，请参阅安装部分如何添加样式表

看看[ 主题]() 部分，更深入地了解如何完全改变 Dropzone 的 UI

我创建了一个例子，在这个例子中，我使 Dropzone 的外观和感觉与 jQuery File Uploader 使用几行配置代码所做的一模一样[ 看看这个](https://www.dropzonejs.com/bootstrap.html)

## **Methods** 方法

如果你想从下拉区删除一个添加的文件，你可以调用`.removeFile(file)` 。此方法还触发`removedfile` 事件

下面是一个文件上传完成后自动删除文件的例子:

```js
myDropzone.on("complete", function(file) {
  myDropzone.removeFile(file);
});
```

如果要删除所有文件，只需使用`.removeAllFiles()` .正在上传的文件不会被删除。如果希望取消当前正在上传的文件，请调用`.removeAllFiles(true)` 会取消上传

如果你有的话`autoProcessQueue` 残疾人，你需要打电话`.processQueue()` 你自己

如果您希望显示文件并让用户单击接受按钮以实际上传文件，那么这将非常有用

要访问下拉区中的所有文件，请使用`myDropzone.files`.

为了得到

- 所有已接受的文件:`.getAcceptedFiles()`
- 所有被拒绝的文件:`.getRejectedFiles()`
- 所有排队的档案:`.getQueuedFiles()`
- 所有上传文件:`.getUploadingFiles()`
- 如果你不再需要降落区了，打电话给我`.disable()` 在物体上。这将删除元素上的所有事件侦听器，并清除所有文件数组。重新启用 Dropzone 使用`.enable()`.
- 如果您不喜欢`confirm` 电话，您可以通过覆盖来自己处理它们`Dropzone.confirm`.

```js
Dropzone.confirm = function(question, accepted, rejected) {
  //提出问题，Ask the question,然后相应地调用accepted() or rejected()
  //小心:可能没有定义拒绝。在这种情况下什么都不要做
};
```

如果希望 Dropzone 显示服务器上的图像，可以使用:

```js
// 回调和交叉起源是可选的
let mockFile = { name: "Filename", size: 12345 };
myDropzone.displayExistingFile(mockFile, 'https://image-url');
```

请参阅常见问题解答[ 如何显示存储在服务器上的文件](https://github.com/dropzone/dropzone/discussions/1909).

## **Upload Queue** 上传队列

当一个文件被添加到下拉区时，它的`status` 设置为`Dropzone.QUEUED` (在`accept` 函数检查通过) ，这意味着文件现在在队列中

如果你有选择的话`autoProcessQueue` 准备好了`true` 然后，在删除文件或上载完成后，通过调用`.processQueue()` 它检查当前上传的文件数量，以及是否少于`options.parallelUploads`, `.processFile(file)` 叫做

如果你设置`autoProcessQueue` 到`false` 那么`.processQueue()` 从未被隐含地称为。这意味着当您想要上传当前排队的所有文件时，必须自己调用它

## **Events** 事件

Dropzone 在处理文件时触发事件，您可以通过调用`.on(eventName, callbackFunction)` 在你的空投区 **例子:**

```js
let myDropzone = Dropzone("#my-element", { /* 选项 */ });
myDropzone.on("addedfile", file => {
  console.log("已添加文件");
});
```

如果以声明方式配置 Dropzone，则无法访问实例来添加事件。在这种情况下，您可以使用`init` Config，这是一个在 Dropzone 初始化时调用的函数:

```js
Dropzone.options.myElement = {
  // 注意:在这里使用“function ()”将‘this'绑定到
  // Dropzone 实例.
  init: function() {
    this.on("addedfile", file => {
      console.log("A file has been added");
    });
  }
};
```

**!注意** **小心点** : 在提供 init 函数时，请确保使用`function()` 语法而不是箭头语法，因为否则`this` 将不会引用 Dropzone 实例[ 箭头函数表达式与函数表达式之间的差异](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions).

这两种方式都非常好，但是您需要使用`init()` 如果以声明方式设置 Dropzone，则返回

Dropzone 本身严重依赖于事件。所有可视的东西都是通过聆听创造出来的。它们是让 Dropzone 看起来和感觉起来如你所愿的基本组成部分

#### List of all events 所有事件的清单

我们将很快在这里列出所有可能发生的事件，但在此之前，您可以找到所有这些事件，详细记录在[ 源代码](https://github.com/dropzone/dropzone/blob/main/src/options.js#L574) .这些是默认事件句柄的实现，因此您可以看到它们接收哪些参数。如果您不感兴趣，可以忽略它们的内容，或者覆盖默认行为(将在下一节中解释)

## Overriding default event handlers 重写默认事件处理程序

一般来说 **你不该这么做的** ，并且如果您决定这样做，您应该熟悉代码**

还可以重写默认事件处理程序。应该绝对谨慎地处理这个问题，因为如果您升级了库，它可能会中断，并且还可能删除您可能不希望丢失的默认功能:

```js
let myDropzone = Dropzone("#my-element", {
  addedfile: file => {
    // 只有在你知道自己在做什么的情况下才能这么做
  }
});
```

这里的不同之处在于，默认的事件处理程序`addedfile` 已更改，而不是添加新的事件处理程序`myDropzone.on("addedfile", () => {})`

只有当你真正知道 Dropzone 是如何工作的时候，以及你想要的时候，你才应该这样做[ 完全主题化你的空降地带]().

## **Theming** 主题

如果你想让你的 Dropzone 看起来完全定制，在大多数情况下，你可以简单地替换预览 HTML 模板，调整你的 CSS，也许还可以创建一些额外的事件监听器

布局部分已经介绍过了

[Layout 布局](https://docs.dropzone.dev/configuration/basics/layout)

采用这种方法，您将走得很远。作为一个示例，我创建了一个示例，其中我使 Dropzone 的外观和感觉与 jQuery File Uploader 使用几行配置代码所做的一模一样[ 看看这个](https://www.dropzone.dev/bootstrap.html)

如您所见，最大的变化是`previewTemplate` . 然后，我添加了一些额外的事件侦听器，使其看起来与引用完全一样

# Completely change the way Dropzone is displayed 完全改变 Dropzone 的显示方式

Dropzone 本身在创建 Dropzone 时设置了许多事件侦听器，这些事件侦听器可以处理所有 UI。它们可以做这样的事情: 创建一个新的 HTML 元素，添加`<img>` 元素时，提供的图像数据(与`thumbnail` 事件时更新进度栏`uploadprogress` 事件触发时，显示一个选中标记`success` 火灾等

*一切* 可视化是在这些事件处理程序中完成的。如果你用空函数覆盖所有文件，Dropzone 仍然可以正常工作，但是不会再显示被删除的文件

> 如果你喜欢 Dropzone 的默认外观，但只是想在这里和那里添加一些附加功能，你应该只是[ 添加其他事件侦听器]() 取而代之

覆盖默认的事件侦听器，并创建自己的自定义 Dropzone，如下所示:

```js
// 这是一个完全禁用Dropzone的默认行为的例子
// 除非你真的知道自己在做什么，否则不要使用它

Dropzone.myDropzone.options = {
  previewTemplate: document.querySelector('#template-container').innerHTML,
  // 指定事件作为配置选项覆盖默认值
  // `addedfile` 处理事件
  addedfile: function(file) {
    file.previewElement = Dropzone.createElement(this.options.previewTemplate);
    // 现在将这个新元素附加到页面的某个位置
  },
  thumbnail: function(file, dataUrl) {
    // 在file.previewElement中显示图像
  },
  uploadprogress: function(file, progress, bytesSent) {
    // 显示进度
  }
  // 等等...
};
```

显然，这缺乏实际的实现。看看源代码，看看 Dropzone 是如何在内部实现的

如果你不需要任何默认的 Dropzone UI，但只对 Dropzone 的事件处理、文件上传和拖放功能感兴趣，那么你应该使用这个选项

## **Tutorials** 教程

在本节中，您将学习如何使用 Dropzone 做更复杂的事情

## **将表单数据与文件组合在一起**

创建一个包含各种其他输入字段的表单，这些字段也充当 Dropzone

你想有一个正常的形式，你可以放下文件，并发送整个形式，包括文件，只需点击一个按钮？你很幸运。这需要一些配置，但并不难做到

首先，您需要确保 Dropzone 不会自动处理您的队列并开始分别上传每个文件。这是通过设置以下属性实现的:

- `autoProcessQueue: false` Dropzone 应该等待用户单击一个按钮上传
- `uploadMultiple: true` Dropzone 应该一次上传所有文件(包括表单数据) ，而不是单独上传所有文件
- `parallelUploads: 100` 这意味着它们也不应该被分割成小块
- `maxFiles: 100` 这是为了确保用户在一个请求中删除的文件不超过允许的数量

这基本上就是你需要做的所有事情 *Dropzone 自动提交表单中的所有输入字段，该表单的行为类似于 Dropzone*.

#### Show me the code 案例代码

下面是一个非常简单的 HTML:

```html
<form id="upload-form" class="dropzone">
  <!-- 这是应该播放的预告片。 -->
  <div class="previews"></div>
  
  <!-- 现在设置您的输入字段 -->
  <input type="email" name="username" />
  <input type="password" name="password" />

  <button type="submit">Submit data and files!</button>
</form>
```

现在是 Dropzone 配置:

```js
Dropzone.options.uploadForm = { // 表单元素的ID的骆驼化版本

  // The configuration we've talked about above
  autoProcessQueue: false,
  uploadMultiple: true,
  parallelUploads: 100,
  maxFiles: 100,

  // 上面讨论过的配置
  init: function() {
    var myDropzone = this;

    // 首先更改按钮以实际告诉Dropzone处理队列
    this.element.querySelector("button[type=submit]").addEventListener("click", function(e) {
      // 确保表单实际上没有被发送
      e.preventDefault();
      e.stopPropagation();
      myDropzone.processQueue();
    });

    //监听发送多个事件。在本例中，它是发送多个事件
      //的发送事件，因为uploadMulti被设置为true
    this.on("sendingmultiple", function() {
      //在实际发送窗体时触发
      //隐藏成功按钮或完整表单
    });
    this.on("successmultiple", function(files, response) {
      //在成功发送文件时触发
        //重定向用户或成功通知
    });
    this.on("errormultiple", function(files, response) {
      //在发送文件时出错时触发
      //也许再次显示表单，并通知用户错误
    });
  }
 
}
```

就是这样
